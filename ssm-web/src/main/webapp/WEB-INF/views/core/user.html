#parse("header-top.html")#parse("sub-header-bottom.html")<style></style><!-- /section:basics/navbar.layout --><div class="main-container ace-save-state" id="main-container">    <script type="text/javascript">        try {            ace.settings.loadState('main-container')        } catch (e) {        }    </script>    <!-- /section:basics/sidebar -->    <div class="main-content">        <div class="main-content-inner">            <div class="page-content-iframe">                <div class="row">                    <div class="col-xs-12">                        <!-- PAGE CONTENT BEGINS -->                        <div class="row">                            <div class="col-xs-12 table-tools">                                <button class="create btn btn-pink btn-sm pull-right">新增用户</button>                                <button class="refresh btn btn-warning btn-sm">刷新                                    <i class="ace-icon fa fa-refresh align-iddle bigger-125"></i>                                </button>                            </div>                        </div>                        <div class="row">                            <div class="col-xs-12">                                <div class="table-header">                                    用户列表                                </div>                                <table id="table" class="table table-striped table-bordered table-hover"></table>                            </div>                        </div>                        <!-- PAGE CONTENT ENDS -->                    </div><!-- /.col -->                </div><!-- /.row -->            </div><!-- /.page-content -->        </div>    </div><!-- /.main-content --></div><!-- /.main-container --><div class="user-dialog bootbox modal fade in" tabindex="-1" role="dialog" aria-hidden="false"     style="display: none;padding-top: 20px;">    <div class="modal-dialog">        <div class="modal-content">            <div class="modal-header">                <button type="button" class="bootbox-close-button close">×</button>                <h4 class="modal-title"></h4>            </div>            <div class="modal-body">                <div class="bootbox-body">                    <form class="user-form form-horizontal" method="get" novalidate="novalidate">                        <input type="hidden" name="id" id="id">                        <div class="form-group">                            <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="loginId">登录ID:</label>                            <div class="col-xs-12 col-sm-9">                                <div class="clearfix">                                    <input type="text" name="loginId" id="loginId" class="col-xs-12 col-sm-4">                                </div>                            </div>                        </div>                        <div class="space-2"></div>                        <div class="form-group">                            <label class="control-label col-xs-12 col-sm-3 no-padding-right"                                   for="name">用户名称:</label>                            <div class="col-xs-12 col-sm-9">                                <div class="clearfix">                                    <input type="text" name="name" id="name" class="col-xs-12 col-sm-4">                                </div>                            </div>                        </div>                        <div class="space-2 user-password"></div>                        <div class="form-group user-password">                            <label class="control-label col-xs-12 col-sm-3 no-padding-right"                                   for="password">用户密码:</label>                            <div class="col-xs-12 col-sm-9">                                <div class="clearfix">                                    <input type="password" name="password" id="password" class="col-xs-12 col-sm-4">                                </div>                            </div>                        </div>                        <div class="space-2  user-password"></div>                        <div class="form-group user-password">                            <label class="control-label col-xs-12 col-sm-3 no-padding-right"                                   for="password2">重复密码:</label>                            <div class="col-xs-12 col-sm-9">                                <div class="clearfix">                                    <input type="password" name="password2" id="password2" class="col-xs-12 col-sm-4">                                </div>                            </div>                        </div>                        <div class="space-2"></div>                        <div class="form-group">                            <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="email">用户邮箱:</label>                            <div class="col-xs-12 col-sm-9">                                <div class="clearfix">                                    <input type="email" name="email" id="email" class="col-xs-12 col-sm-6">                                </div>                            </div>                        </div>                    </form>                </div>            </div>            <div class="modal-footer">                <button type="button" class="btn btn-sm btn-primary bootbox-save-button">                    <i class="fa fa-save"></i>                    保存                </button>                <button type="button" class="btn btn-sm bootbox-close-button">                    <i class="fa fa-remove red"></i>                    取消                </button>            </div>        </div>    </div></div><div class="user-role-dialog bootbox modal fade in" tabindex="-1" role="dialog" aria-hidden="false"     style="display: none;padding-top: 20px;">    <div class="modal-dialog">        <div class="modal-content">            <div class="modal-header">                <button type="button" class="bootbox-close-button close">×</button>                <h4 class="modal-title">设置用户角色</h4>            </div>            <div class="modal-body">                <div class="bootbox-body">                    <div class="role-list"></div>                </div>            </div>            <div class="modal-footer">                <div class="checkbox pull-left">                    <label>                        <input name="form-field-checkbox" id="checkAllData" type="checkbox"                               class="ace icon icon-check-empty">                        <span class="lbl"> 全选</span>                    </label>                </div>                <button type="button" class="btn btn-sm btn-primary user-role-save-button">                    <i class="fa fa-save"></i>                    保存                </button>                <button type="button" class="btn btn-sm bootbox-close-button">                    <i class="fa fa-remove red"></i>                    取消                </button>            </div>        </div>    </div></div>#parse("footer-top.html")<!-- 页面特定的插件脚本 --><script type="text/javascript" src="$res/components/security/sha256.js"></script><script type="text/javascript" src="$res/components/datatables/media/js/jquery.dataTables.js"></script><script type="text/javascript" src="$res/components/_mod/datatables/jquery.dataTables.bootstrap.js"></script><script type="text/javascript" src="$res/components/datatables.net-buttons/js/dataTables.buttons.js"></script><script type="text/javascript" src="$res/components/datatables.net-buttons/js/buttons.flash.js"></script><script type="text/javascript" src="$res/components/datatables.net-buttons/js/buttons.html5.js"></script><script type="text/javascript" src="$res/components/datatables.net-buttons/js/buttons.print.js"></script><script type="text/javascript" src="$res/components/datatables.net-buttons/js/buttons.colVis.js"></script><script type="text/javascript" src="$res/components/datatables.net-select/js/dataTables.select.js"></script><script type="text/javascript" src="$res/components/bootbox.js/bootbox.min.js"></script>#parse("footer-bottom.html")<!-- 与此页面相关的内联脚本 --><script type="text/javascript">    var oTable, formData, dialog, validate, url, userId;    var formObj = '.user-form';    var dialogObj = '.user-dialog';    var userRoleDialog = '.user-role-dialog';    $(function () {        $(".refresh").bind('click',function () {            drawTable(oTable,true);        });        setTimeout(function () {            enableTooltips('.widget-header', '.action-buttons');        }, 0);        validate = $(formObj).validate({            errorElement: 'div',            errorClass: 'help-block',            focusInvalid: false,            rules: {                loginId: {required: true, minlength: 5},                name: {required: true},                password: {required: true, minlength: 6},                password2: {required: true, minlength: 6, equalTo: "#password"},                email: {required: true}            },            messages: {                loginId: {required: "登录ID不能为空.", minlength: "不能少于{0}位字符."},                name: {required: "用户名称不能为空."},                password: {required: "密码不能为空.", minlength: "不能少于{0}位字符."},                password2: {required: "重复密码不能为空.", minlength: "不能少于{0}位字符.", equalTo: "二次密码输入不正确."},                email: {required: "用户邮箱不能为空.", email: "请输入正确格式的邮箱地址."}            },            invalidHandler: function (event, validator) { //display error alert on form submit                $('.alert-danger', $('.user-form')).show();            },            highlight: function (e) {                $(e).closest('.form-group').removeClass('has-info').addClass('has-error');            },            success: function (e) {                $(e).closest('.form-group').removeClass('has-error').addClass('has-info');                $(e).remove();            },            errorPlacement: function (error, element) {                if (element.is(':checkbox') || element.is(':radio')) {                    var controls = element.closest('div[class*="col-"]');                    if (controls.find(':checkbox,:radio').length > 1) controls.append(error);                    else error.insertAfter(element.nextAll('.lbl:eq(0)').eq(0));                }                else if (element.is('.select2')) {                    error.insertAfter(element.siblings('[class*="select2-container"]:eq(0)'));                }                else if (element.is('.chosen-select')) {                    error.insertAfter(element.siblings('[class*="chosen-container"]:eq(0)'));                }                else error.insertAfter(element.parent());            },            submitHandler: function (form) {                console.info(form)            },            invalidHandler: function (form) {            }        });        oTable = $('#table').dataTable({            sAjaxSource: ctx + '/core/user/query?now=' + new Date().getTime(),            sAjaxDataProp: 'rows',            bProcessing: false,            bAutoWidth: false, //是否启用自动适应列宽            bPaginate: true,            bServerSide: true,            aoColumns: [                {sTitle: "登录ID", mDataProp: "loginId", bSortable: false, bSearchable: false},                {sTitle: "用户名称", mDataProp: "name", bSortable: false, bSearchable: false},                /*{sTitle: "邮箱地址", mDataProp: "email", 'sClass': 'hidden-480', bSortable: false, bSearchable: false},*/                {sTitle: "创建用户", mDataProp: "creator", 'sClass': 'hidden-890', bSortable: false, bSearchable: false},                {sTitle: "创建日期", mDataProp: "createTime", 'sClass': 'hidden-890', bSortable: true, bSearchable: false},                {sTitle: "更新用户", mDataProp: "updateBy", 'sClass': 'hidden-690', bSortable: false, bSearchable: false},                {sTitle: "更新日期", mDataProp: "updateTime", 'sClass': 'hidden-690', bSortable: true, bSearchable: false},                {sTitle: "操作", mDataProp: "id", 'sClass': "text-center", sWidth: '100', bSortable: false}            ],            aoColumnDefs: [                {aTargets: [6], mRender: formatOperator}            ],            fnDrawCallback: function () {                $('body').hideLoading();                setTimeout(function () {                    enableTooltips(oTable, '.action-buttons');                }, 0);                initButtonEvent();                resetIframeHeight();            }        });        $('.bootbox-save-button').on('click', function () {            if (!$(formObj).valid()) return false;            var data = $(formObj).serializeObject();            data.password = sha256_digest(data.password);            http.post(url, data, function (r) {                drawTable(oTable,true);                showSuccessTips("数据保存成功.");                $(dialogObj).modal('hide');            });        });        $('.user-role-save-button').on('click', function () {            url = '/core/userRole/add';            var nodes = $('.role-list input[type="checkbox"]:checked');//获取所有选中节点对象            var array = [];            if (nodes && nodes.length > 0) {                $.each(nodes, function (i, item) {                    array.push($(item).val());                });            }            var data = {userId: userId, roleId: array.join(',')};            http.post(url, data, function (r) {                drawTable(oTable,true);                showSuccessTips("用户角色保存成功.");                $(userRoleDialog).modal('hide');            });        });    });    function initButtonEvent() {        $('.create').on('click', function (data) {            formData = $.extend({}, {});            url = '/core/user/add';            $('.user-password').show();            showDialog(dialogObj, '新增用户信息', validate, formObj, formData);        });        $('.edit').on('click', function (e) {            var id = $(this).data('id');            var data = fnGetTableData(oTable, 'id', id);            formData = $.extend({}, data);            url = '/core/user/update';            $('#loginId').attr('readonly', 'readonly');            $('.user-password').hide();            showDialog(dialogObj, '修改用户信息', validate, formObj, formData);        });        $('.setRole').on('click', function () {            userId = $(this).data('id');            url = '/core/userRole/query';            var data = {userId: userId};            http.getJSON(url, data, function (r) {                if (r) {                    var html = '';                    var i = 1;                    var j = 0;                    html += '<div class="row">';                    $.each(r, function () {                        var item = this;                        html += '    <div class="col-xs-12 col-sm-6">';                        html += '       <div class="checkbox">';                        html += '           <label>';                        if (item.checked) {                            j++;                            html += '               <input name="roleId" type="checkbox" class="ace role-checkbox" value="' + item.id + '" checked>';                        } else {                            html += '               <input name="roleId" type="checkbox" class="ace role-checkbox" value="' + item.id + '">';                        }                        html += '               <span class="lbl"> ' + item.name + '</span>';                        html += '           </label>';                        html += '       </div>';                        html += '      </div>';                        if (i % 2 === 0) {                            html += '</div>';                            html += '<div class="row">';                        }                        i++;                    });                    $('.role-list').html(html);                    if (j === r.length) {                        //$('#checkAllData').attr('checked', 'checked');                    }                    $('#checkAllData').on('click', function () {                        var permissionCheck = this;                        $('.role-list input[type="checkbox"]').each(function (i, item) {                            item.checked = permissionCheck.checked;                        });                    });                    $('.role-checkbox').on('click', function () {                        if (!this.checked) {                            if ($('#checkAllData')[0].checked)                                $('#checkAllData')[0].checked = false;                        } else {                            var checkLen = $('.role-list input[type="checkbox"]:checked').length;                            if (checkLen === r.length) {                                $('#checkAllData')[0].checked = true;                            }                        }                    })                }            });            $(userRoleDialog).modal('show');        });        $('.delete').on('click', function () {            var id = $(this).data('id');            confirmDialog('确定要删除该用户信息吗？', '信息删除', function (result) {                if (result) {                    http.getJSON('/core/user/delete/' + id, function (r) {                        drawTable(oTable,true);                        showSuccessTips("用户信息删除成功.");                    })                }            });        });    }    function formatOperator(data, type, full) {        var s = '<div class="hidden-sm hidden-xs action-buttons">                                                                    ';        s += '<a href="#" class="edit blue" data-id="' + data + '" title="编辑用户"><i class="fa fa-pencil align-top bigger-125"></i></a> ';        s += '<a href="#" class="setRole orange" data-id="' + data + '" title="设置角色"><i class="fa fa-cogs align-top bigger-125"></i></a> ';        /*s += '<a href="#" class="delete red" data-id="' + data + '" title="删除用户"><i class="fa fa-trash align-top bigger-125"></i></a> ';*/        s += '</div>                                                                                                              ';        s += '<div class="hidden-md hidden-lg">                                                                                   ';        s += '	<div class="inline pos-rel">                                                                                      ';        s += '		<button class="btn btn-minier btn-yellow dropdown-toggle" data-toggle="dropdown" data-position="auto">          ';        s += '			<i class="ace-icon fa fa-caret-down icon-only bigger-120"></i>                                                ';        s += '		</button>                                                                                                       ';        s += '                                                                                                                    ';        s += '		<ul class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close"> ';        s += '			<li>                                                                                                          ';        s += '				<a href="#" class="edit tooltip-info" data-rel="tooltip" title="编辑用户">                                           ';        s += '					<span class="blue">                                                                                       ';        s += '						<i class="ace-icon fa fa-pencil align-top bigger-120"></i>                                                   ';        s += '					</span>                                                                                                   ';        s += '				</a>                                                                                                        ';        s += '			</li>                                                                                                         ';        s += '			<li>                                                                                                          ';        s += '				<a href="#" class="setRole tooltip-info" data-rel="tooltip" title="设置角色">                                           ';        s += '					<span class="blue">                                                                                       ';        s += '						<i class="ace-icon fa fa-cogs orange align-top bigger-120"></i>                                                   ';        s += '					</span>                                                                                                   ';        s += '				</a>                                                                                                        ';        s += '			</li>                                                                                                         ';        s += '			<li>                                                                                                          ';        s += '				<a href="#" class="delete tooltip-info" data-rel="tooltip" title="删除用户">                                           ';        s += '					<span class="blue">                                                                                       ';        s += '						<i class="ace-icon fa fa-trash align-top red bigger-120"></i>                                                   ';        s += '					</span>                                                                                                   ';        s += '				</a>                                                                                                        ';        s += '			</li>                                                                                                         ';        s += '		</ul>                                                                                                           ';        s += '	</div>                                                                                                            ';        s += '</div>                                                                                                              ';        return s;    }</script></body></html>